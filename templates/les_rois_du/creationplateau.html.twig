{% extends 'monTemplate.html.twig' %}


{% block sidebar %}

<body class="is-preload">
  <!-- Sidebar -->
  <section id="sidebar">
    <div class="inner">
      <nav>
        <ul>
          <li><a href="{{path('hub')}}">RETOUR</a></li>
        </ul>
      </nav>
    </div>
  </section>
  {% endblock %}

  {% block body %}
  <!-- Wrapper -->
  <div id="wrapper">

    <!-- Intro -->
    <section id="partie" class="wrapper style1 fullscreen fade-up">
      <div class="inner">
        {% if action == 'creer' %}
        <h1>CREER UN PLATEAU</h1>

        <section id="three" class="wrapper style1 fade-up">
          <div class="inner">

          <div class="inner" id="ensembleformulaire">
            {{form_start(vueFormulaireCreationPlateau) }}
            <div class="inner" id="unecase">
            {{ form_row(vueFormulaireCreationPlateau.nom)}}
            </div>
            {{ form_row(vueFormulaireCreationPlateau.description)}}
            {{ form_row(vueFormulaireCreationPlateau.niveauDifficulte, { 'label' : 'Niveau de difficulté' })}}
            <div class="inner" id="formulaireNbDefis">
            {{ form_row(vueFormulaireCreationPlateau.nbCases, { 'label' : 'Taille du plateau (nombre de défis)' })}}
            </div>

            <div id="ensemblecases">
            <h3>Cases/Défis</h3>
               <ul class="casesliste" id="casesliste" data-prototype="{{ form_widget(vueFormulaireCreationPlateau.cases.vars.prototype)|e('html_attr')}}">
                   {% for unecase in vueFormulaireCreationPlateau.cases %}
                       <li>{{ form_row(unecase.descriptifDefi) }}</li>
                   {% endfor %}
               </ul>
            </div>

          </div>
            <Br>

          <div class="row">
                    <div class="col-md-12">
             <a href="" class="button submit">Valider la création </a>
             <a href="{{ path('hub')}}" class="button scrolly">Annuler la création </a>
          </div>
        </div>

          </div>

          {{form_end(vueFormulaireCreationPlateau)}}

        {%else%}

        <h1>MODIFIER UN PLATEAU</h1>
        <section id="three" class="wrapper style1 fade-up">
          <div class="inner">

            {{form_start(vueFormulaireCreationPlateau) }}
            {{ form_row(vueFormulaireCreationPlateau.nom)}}
            {{ form_row(vueFormulaireCreationPlateau.description)}}
            {{ form_row(vueFormulaireCreationPlateau.niveauDifficulte, { 'label' : 'Niveau de difficulté' })}}

            <Br>


          <div class="row">
                    <div class="col-md-12">
             <a href="" class="button submit">Valider la modification </a>
             <a href="{{ path('parametres_plateau', {'idPlateau' : plateau.id}) }}" class="button scrolly">Annuler la modification </a>
          </div>
        </div>

          </div>

          {{form_end(vueFormulaireCreationPlateau)}}

        {% endif %}

      </div>
    </section>
  </div>
  </section>

  </div>



  <script>


  document.addEventListener("DOMContentLoaded", function(event) {


    //mise en place d'un lien "ajouter une case"
    var $addCaseLink = $('<button href="#" class="add_cases_link">Ajouter une case</button>');
    var $newLinkLi = $('<li></li>').append($addCaseLink);


    jQuery(document).ready(function() {
        // prendre la liste qui contient la collection de cases
       var $collectionHolder = $('ul.casesliste');

        $collectionHolder.append($newLinkLi);

        $collectionHolder.data('index', $collectionHolder.find(':input').length);

        selecteur = document.getElementById('plateau_nbCases');
        selecteur.addEventListener("change", function(){
          // Vide tout les enfants afin d'eviter que les champs de saisie s'ajoutent après changement de valeur dans le selecteur
          // while (ensemblecases.firstChild) { //Mettre case liste ?
          //  ensemblecases.removeChild(ensemblecases.lastChild);
          //     }
          //
        nbDefis = document.getElementById('plateau_nbCases').value;
        for (i=0; i<nbDefis; i++) {
        addCaseForm($collectionHolder, $newLinkLi);
        }
        });


        $addCaseLink.on('click', function(e) {

            e.preventDefault();

            addCaseForm($collectionHolder, $newLinkLi);
        });
    });

    function addCaseForm($collectionHolder, $newLinkLi) {
        // prendre le data prototype
        var prototype = $collectionHolder.data('prototype');

        // prendre le nouvel index
        var index = $collectionHolder.data('index');

        var newForm = prototype.replace(/__name__/g, index);

        $collectionHolder.data('index', index + 1);

        var $newFormLi = $('<li></li>').append(newForm);

        $newLinkLi.before($newFormLi);

        // add a delete link to the new form
        addCaseFormDeleteLink($newFormLi);
    }

    function addCaseFormDeleteLink($caseFormLi) {
    var $removeFormButton = $('<button class="button small" type="button">Supprimer</button> <br> <br>');
    $caseFormLi.append($removeFormButton);

    $removeFormButton.on('click', function(e) {
        // remove the li for the tag form
        $caseFormLi.remove();
    });
}

});


  </script>



  {% endblock %}

  {% block vueFormulaireCreationPlateau_cases_entry_widget %}
{{ dump() }}
  {% endblock %}


  {% block footer %}
  {% endblock %}
